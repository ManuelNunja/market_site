<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market</title>
    <!-- JQUERY -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="js/app.js"></script>
    <link href="css/style.css" rel="stylesheet">
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://kit.fontawesome.com/a59e25dd52.js" crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="headSite">
            <div class="sideLeft">
                <div class="background">
                    <a href="index.html">
                        <img src="resources/images/logo/logoV2_6_3.png">
                    </a>
                </div>
            </div>
            <div class="sideRight">
                <div class="background">
                    <span class="buttonMenu">M</span>
                </div>
                <div class="menuNotification"></div>
            </div>
        </div>
    </header>
    <nav>
        <div class="animation--bar barRight">
            <div class="background">
                <div class="itemBar menuCart" data-item="Carrito de compras">
                    <i class="fas fa-shopping-cart"></i>
                    <div class="notification"></div>
                </div>
                <div class="itemBar menuUser" data-item="Usuario">
                    <i class="fas fa-user-circle"></i>
                    <div class="notification"></div>
                </div>
                <div class="itemBar menuShopping" data-item="Mis compras">
                    <i class="fas fa-shopping-bag"></i>
                    <div class="notification"></div>
                </div>
                <div class="itemBar menuNotification" data-item="Notificaciones">
                    <i class="fas fa-bell"></i>
                    <div class="notification"></div>
                </div>
            </div>
        </div>
        <div class="toolTipItems"></div>
        <div class="cartPreview">
            <div class="background">
                <div class="closeBar">
                    <div class="title">
                        <h3>Carrito de compras</h3>
                    </div>
                    <div class="closeButtonCart">
                        <span>X</span>
                    </div>
                </div>
                <div id="cart_listItems" class="listItems">
                </div>
                <div class="totalCart">
                    <div class="space1"></div>
                    <div class="label">
                        <h3>TOTAL</h3>
                    </div>
                    <div class="amount">
                        <span>$ 300.00</span>
                    </div>
                    <div class="space2"></div>
                </div>
            </div>
        </div>
    </nav>
    <main>
        <div class="container_site animation--width">
            <div class="controlBanner">
                <div class="sideLeft">
                    <div class="background">
                        <img src="resources/images/banner/banner1.png">
                    </div>
                </div>
                <div class="sideRight">
                    <div class="background">
                        <img src="resources/images/banner/banner2.png">
                    </div>
                </div>
            </div>
            <div class="sectionTitle">
                <div class="background">
                    <h2>Ofertas</h2>
                </div>
            </div>
            <div id="controlOffer" class="controlOffer" data-offer="1"></div>
            <div class="controlPayMethod">
                <div class="background">
                    <div class="itemPayM"><a class="textLink" href="">Metodos de pago seguro</a></div>
                    <div class="itemPayM"><a class="name">VISA</a></div>
                    <div class="itemPayM"><a class="name">MASTER CARD</a></div>
                    <div class="itemPayM"><a class="name">DINERS CLUB</a></div>
                    <div class="itemPayM"><a class="name">AMERICAN EXPRESS</a></div>
                    <div class="itemPayM"><a class="textLink" href="">Metodos de pago seguro</a></div>
                </div>
            </div>
            <div class="sectionTitle">
                <div class="background">
                    <h2>Tiendas Oficiales</h2>
                </div>
            </div>
            <div class="controlStores" id="controlStores">
            </div>
            <div class="sectionTitle">
                <div class="background">
                    <h2>Categorias</h2>
                </div>
            </div>
            <div class="controlCategories" id="controlCategories">
            </div>
            <div class="controlPreviewProduct" id="controlPreviewProduct">
                <div class="background">
                    <div class="percentOffer">
                        <span class="percent">50%</span>
                    </div>
                    <div class="closeButton"><span>X</span></div>
                    <div class="imgOffer"></div>
                    <div class="logoM"><span>M</span></div>
                    <div class="priceOffer">
                        <span class="before"></span>
                        <span class="after"></span>
                    </div>
                    <div class="cart" data-offer="">
                        <i class="fas fa-cart-plus"></i>
                        <i class="fas fa-cart-plus"></i>
                    </div>
                </div>
            </div>
            <div class="controlUserRegister">
                <div class="background">
                    <h3 class="title">
                        Registro de Usuario
                    </h3>
                    <form>
                        <div class="row">
                            <span class="label">Nombres</span>
                            <input id="inputNombres" class="inputSite" type="text">
                        </div>
                        <div class="row">
                            <span class="label">Apellidos</span>
                            <input id="inputApellidos" class="inputSite" type="text">
                        </div>
                        <div class="row">
                            <span class="label">Fecha nacimiento</span>
                            <input id="inputFechaNac" class="inputSite" type="text">
                        </div>
                        <div class="row">
                            <span class="label">Pais</span>
                            <select class="dropdownCountry">
                                <option>[select country]</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
            <div id="controlMessageSite" class="controlMessageSite"></div>
        </div>
    </main>
    <footer>

    </footer>
    <script>
        //cargarCompra();
        CreateStore();
        CreateCategory();
        createJSON_Offer();
        // DESAFIO: "INCORPORAR JQUERY AL PROYECTO"
        $(document).ready(function(){
            const containerControl = $("#controlOffer");
            let background = document.createElement("div");
            let row = document.createElement("div");
            $(background).addClass("background");
            $(row).addClass("row");
            let delayAnim = 1;
            for(i = 0; i <= 6; i++){
                let itemOffer = CreatElement_Offer(i);
                // DESAFIO: "ANIMACIONES ENCADENADAS"
                $(itemOffer).click(function(){
                    $("#controlPreviewProduct").fadeIn(100)
                    .css("display","flex");
                    setTimeout(() => {
                        $("#controlPreviewProduct").removeClass("controlPreviewProduct--animateHide");
                        $("#controlPreviewProduct").addClass("controlPreviewProduct--animateShow");
                    }, 200);
                    setTimeout(() => {
                        $("#controlPreviewProduct").animate({
                            width: "360px",
                            height: "400px",
                        }, 0)
                        let offerId = $(itemOffer).attr("data-offer");
                        let productOffer = getOfferData(offerId);
                        let backImage = "url(" + productOffer.offerImage + ")";
                        $(".controlPreviewProduct .background .percentOffer .percent").text(productOffer.offerPercentDiscount);
                        $(".controlPreviewProduct .background .priceOffer .before").text("Antes: $" + productOffer.offerProductPrice)
                        $(".controlPreviewProduct .background .priceOffer .after").text("$ " + productOffer.offerProductPriceDiscount);
                        $(".controlPreviewProduct .background .cart").attr("data-offer", offerId);
                        $(".imgOffer").css("background-image",backImage);
                    }, 750);
                    setTimeout(() => {
                        $("#controlPreviewProduct").animate({
                            width: "360px",
                            height: "700px",
                        }, 0)
                        setTimeout(() => {
                            $(".closeButton").animate({
                                opacity: 1
                            }, 0)
                        }, 0);
                    }, 1200);
                    setTimeout(() => {
                        $(".priceOffer").removeClass("ImageStore--animateHide");
                        $(".priceOffer").addClass("ImageStore--animateShow");
                        $(".percentOffer").removeClass("ImageStore--animateHide");
                        $(".percentOffer").addClass("ImageStore--animateShow");
                        $(".cart").removeClass("ImageStore--animateHide");
                        $(".cart").addClass("ImageStore--animateShow");
                    }, 1300);
                    setTimeout(() => {
                        $(".percentOffer").addClass("Animation--pulse");
                    }, 1600);
                    $(".closeButton").click(function(){
                        $(".itemOffer").off("click");
                        closeButton();
                    });
                    function closeButton(){
                        $("#controlPreviewProduct").animate({
                            width: "360px",
                            height: "400px",
                        }, 0)
                        setTimeout(() => {
                            $(".priceOffer").removeClass("ImageStore--animateShow");
                            $(".priceOffer").addClass("ImageStore--animateHide");
                            $(".percentOffer").removeClass("ImageStore--animateShow");
                            $(".percentOffer").addClass("ImageStore--animateHide");
                            $(".percentOffer").removeClass("Animation--pulse");
                            $(".cart").removeClass("ImageStore--animateShow");
                            $(".cart").addClass("ImageStore--animateHide");
                        }, 900);
                        setTimeout(() => {
                            $("#controlPreviewProduct").animate({
                                width: "88px",
                                height: "88px",
                            }, 0)
                        }, 1000);
                        setTimeout(() => {
                            $("#controlPreviewProduct").removeClass("controlPreviewProduct--animateShow");
                            $("#controlPreviewProduct").addClass("controlPreviewProduct--animateHide");
                        }, 1500);
                        setTimeout(() => {
                            $(".itemOffer").on("click", function(){
                                $("#controlPreviewProduct").fadeIn(100)
                                .css("display","flex");
                                setTimeout(() => {
                                    $("#controlPreviewProduct").removeClass("controlPreviewProduct--animateHide");
                                    $("#controlPreviewProduct").addClass("controlPreviewProduct--animateShow");
                                }, 200);
                                setTimeout(() => {
                                    $("#controlPreviewProduct").animate({
                                        width: "360px",
                                        height: "400px",
                                    }, 0)
                                    let offerId = $(this).attr("data-offer");
                                    let productOffer = getOfferData(offerId);
                                    let backImage = "url(" + productOffer.offerImage + ")";
                                    $(".controlPreviewProduct .background .percentOffer .percent").text(productOffer.offerPercentDiscount);
                                    $(".controlPreviewProduct .background .priceOffer .before").text("Antes: $" + productOffer.offerProductPrice)
                                    $(".controlPreviewProduct .background .priceOffer .after").text("$" + productOffer.offerProductPriceDiscount);
                                    $(".controlPreviewProduct .background .cart").attr("data-offer", offerId);
                                    $(".imgOffer").css("background-image",backImage);
                                }, 750);
                                setTimeout(() => {
                                    $("#controlPreviewProduct").animate({
                                        width: "360px",
                                        height: "700px",
                                    }, 0)
                                    setTimeout(() => {
                                        $(".closeButton").animate({
                                            opacity: 1
                                        }, 0)
                                    }, 1500);
                                }, 1200);
                                setTimeout(() => {
                                    $(".priceOffer").removeClass("ImageStore--animateHide");
                                    $(".priceOffer").addClass("ImageStore--animateShow");
                                    $(".percentOffer").removeClass("ImageStore--animateHide");
                                    $(".percentOffer").addClass("ImageStore--animateShow");
                                    $(".cart").removeClass("ImageStore--animateHide");
                                    $(".cart").addClass("ImageStore--animateShow");
                                }, 1300);
                                setTimeout(() => {
                                    $(".percentOffer").addClass("Animation--pulse");
                                }, 1600);
                            });
                        }, 1600);
                    }
                });
                $(row).append(itemOffer);
                delayAnim++;
            }
            $(background).append(row);
            $(containerControl).append(background);
            // LOAD CART
            let arrayCart = loadCart();
            if(arrayCart != "No hay elementos seleccionados"){
                for(i = 0; i <= arrayCart.length - 1; i++){
                    let item = createItemCart(arrayCart[i]);
                    $(".cartPreview .background .listItems").append(item);
                    $(".menuNotification").addClass("menuNotification--active");
                    $(".menuCart .notification").addClass("notification--active");
                }
            }
        })
    </script>
    <script>
        // DESAFIO "AJAX EN TU PROYECTO"
        function LoadCountries(){
            const urlget = "https://restcountries.com/v3.1/all";
            $.get(urlget, function(respuesta, estado){
                if(estado === "success"){
                    let misdatos = respuesta;
                    for(var x in misdatos){
                        let optionDrop = document.createElement("option");
                        optionDrop.innerHTML = misdatos[x].name.common;
                        optionDrop.setAttribute("data-flag", misdatos[x].flags.svg)
                        $(".dropdownCountry").append(optionDrop);
                    }
                }
            });
        }
        $(".container_site").click(function(){
            $(".cartPreview").removeClass("cartPreview--show");
            $(".animation--bar").removeClass("barRight--show");
            $(".animation--width").removeClass("container--width");
            
        })
        $(".buttonMenu").click(function(){
            $(".cartPreview").removeClass("cartPreview--show");
            $(".animation--bar").toggleClass("barRight--show");
            $(".animation--width").toggleClass("container--width");
        })
        $(".menuCart").click(function(){
            $(".cartPreview").toggleClass("cartPreview--show");
        })
        $(".controlPreviewProduct .background .cart").click(function(){
            const dataOffer = $(this).attr("data-offer");
            let product = Cart_AddItem(dataOffer);
            let message = showMessage(product);
            let dataAdd = $(message).attr("data-add");
            if(dataAdd == "true"){
                console.log(dataOffer);
                let item = createItemCart(dataOffer);
                $(".cartPreview .background .listItems").append(item);
                $(".menuNotification").addClass("menuNotification--active");
                $(".menuCart .notification").addClass("notification--active");
                setTimeout(() => {
                    $(".headSite .sideRight .background").removeClass("background--animation"); 
                }, 1200);
            }
            $("#controlMessageSite").append(message);
            setTimeout(() => {
                $(message).remove();
            }, 3700);            
        })
        window.onload = LoadCountries();
        $(".itemBar").hover(function(){
            let text = $(this).attr("data-item");
            let top = $(this).offset().top;
            let left = $(this).offset().left;
            $(".toolTipItems").text(text);
            $(".toolTipItems").css("top",(top + 8));
            //$(".toolTipItems").css("left",(left - 245));
            $(".toolTipItems").toggleClass("toolTipItems--show");

        })
        $(".closeButtonCart").click(function(){
            $(".cartPreview").removeClass("cartPreview--show");
        });
    </script>
</body>
</html>